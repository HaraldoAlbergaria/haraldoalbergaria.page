<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<title>Haraldo Albergaria | Photos Map</title>
  <link rel="shortcut icon" type="image/x-icon" href="../icons/favicon.ico">
  <link rel="stylesheet" type="text/css" href="style.css" />
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
<script src="js/locations.js"></script>
<script src="js/countries.js"></script>
<script src="js/countries_bbox.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v1.11.0/mapbox-gl.css" rel="stylesheet" />
<style>
body { margin: 0; padding: 0; }
#map { position: absolute; top: 0; bottom: 0; width: 100%; }
#menu { position: absolute; background: #fff; padding: 10px;
font-family: 'Open Sans', sans-serif; cursor: default; }
</style>
</head>

<body>

<div id="panel" class="photos-countries-panel"></div>

<div id="map"></div>
<div id="menu">
    <input id="streets-v11" type="radio" name="rtoggle" value="streets" checked="checked" />
    <label for="streets-v11">streets</label>
    <input id="outdoors-v11" type="radio" name="rtoggle" value="outdoors" />
    <label for="outdoors-v11">outdoors</label>
    <input id="satellite-v9" type="radio" name="rtoggle" value="satellite" />
    <label for="satellite-v9">satellite</label>
</div>

<div class="map-switcher">
    <div class="selected-photos">PHOTOS</div>
    <div class="unselected-exhibits" onclick="openExhibits()">EXHIBITS</div>
</div>

<div class="attribution">
    Icons made by <a href="https://www.flaticon.com/authors/turkkub" title="turkkub" target="_blank">turkkub</a> (World) and <a href="https://www.flaticon.com/authors/freepik" title="Freepik">Freepik</a> (Countries) from <a href="https://www.flaticon.com/" title="Flaticon" target="_blank">www.flaticon.com</a>
</div>

<script>

    for (var i = countries.length-1; i >= 0; i--) {
        var country_code = countries[i][0];
        createIcon(country_code);
    }
    
    createIcon('EU');
    createIcon('WW');

    function createIcon(country_code) {
        var country_name = countries_bbox[country_code][0];
        var elem = document.createElement("IMG");
        elem.setAttribute("id", country_code);
        elem.setAttribute("class", "icon");
        elem.setAttribute("src", getIconSrc(country_name));
        elem.setAttribute("title", country_name);
        elem.setAttribute("alt", country_name);
        var div = document.createElement("DIV");
        div.setAttribute("class", "flag-icon");
        div.appendChild(elem);
        document.getElementById("panel").appendChild(div);
    }

    function getIconSrc(name) {
      return "icons/".concat(name.replace(" ", "-").toLowerCase()).concat(".svg");
    }

    countries.forEach(addListener);

    function addListener(country) {
      var country_code = country[0];
      document.getElementById(country_code).addEventListener('click', function() { fitRegion(country_code) });
    }

    document.getElementById('EU').addEventListener('click', function() { fitRegion('EU') });
    document.getElementById('WW').addEventListener('click', function() { fitRegion('WW') });

    mapboxgl.accessToken = 'pk.eyJ1IjoiaGFyYWxkby1maWxobyIsImEiOiJja2NpNmNtNWUwZnZnMnlycDBwM3FjeXp2In0.B1eDc6wvyIq1r_LTC6hX0g';

    var map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11'
    });

    map.addControl(new mapboxgl.FullscreenControl({container: document.querySelector('body')}));

    function openExhibits() {
        window.location.replace("https://hpfilho.github.io/map/exhibits/")
    }
    map.addControl(new mapboxgl.NavigationControl());

    function openExhibits() {
        window.location.replace("https://hpfilho.github.io/map/exhibits/")
    }

    var layerList = document.getElementById('menu');
    var inputs = layerList.getElementsByTagName('input');

    function switchLayer(layer) {
        var layerId = layer.target.id;
        map.setStyle('mapbox://styles/mapbox/' + layerId);
    }

    for (var i = 0; i < inputs.length; i++) {
        inputs[i].onclick = switchLayer;
    }

    var west = 180;
    var south = 90;
    var east = -180;
    var north = -90;

    locations.forEach(addMarker);

    map.fitBounds([
        [west, south],
        [east, north]],
        {padding: 150}
    );

    function addMarker(value) {

        if (value[2] <= 35) {

            new mapboxgl.Marker({color:'#C2185B',scale:0.7,draggable:false})
                .setLngLat(value[0])
                .setPopup(new mapboxgl.Popup({closeButton:false,maxWidth:'566px'}).setHTML(value[1]))
                .addTo(map);
        } else {

            new mapboxgl.Marker({color:'#C2185B',scale:0.7,draggable:false})
                .setLngLat(value[0])
                .setPopup(new mapboxgl.Popup({closeButton:false,maxWidth:'592px'}).setHTML(value[1]))
                .addTo(map);
        }

        if (value[0][0] < west) {
            west = value[0][0];
        }

        if (value[0][0] > east) {
            east = value[0][0];
        }

        if (value[0][1] < south) {
            south = value[0][1];
        }

        if (value[0][1] > north) {
            north = value[0][1];
        }

    }

    function fitRegion(region) {

      var bboxes = countries_bbox[region][1]

      var west = bboxes[0];
      var south = bboxes[1];
      var east = bboxes[2];
      var north = bboxes[3];

      map.fitBounds([
          [west, south],
          [east, north]],
          {padding: 50}
      );

    };

</script>


<!-- Default Statcounter code for photo website
https://haraldo-albergaria.photos/ -->
<script type="text/javascript">
var sc_project=12357551;
var sc_invisible=1;
var sc_security="b15a6b74";
var sc_https=1;
var sc_remove_link=1;
</script>
<script type="text/javascript"
src="https://www.statcounter.com/counter/counter.js" async></script>
<noscript><div class="statcounter"><img class="statcounter"
  src="https://c.statcounter.com/12357551/0/b15a6b74/1/"
  alt="Web Analytics"></div></noscript>
<!-- End of Statcounter Code -->

</body>
</html>
